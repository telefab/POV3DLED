/*
  POV3DLED
  Display a 3d image using tehe persistance of view
 */
#include <avr/pgmspace.h>;
PROGMEM const char charSet[]  = "777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777774444444444444444444444444"
"777777777772444444444444444444444444444"
"777777777744444477777744444444444444444"
"777777777444444777777777244444444444444"
"777777774444476666666666774444444444444"
"777777774444776666666666677444444444444"
"777777744447766666677776677744444444444"
"777777744477766666777777777744444444444"
"777777744477776666677777777774444442777"
"777777444777777766677777777774444447777"
"777777444776777766667777766677444447777"
"777777444766777776666666666677444447777"
"777777444766777776666666666666444447777"
"777777444766777776666666666677444447777"
"777777444776577766666777666677444447777"
"777777444774677666677777766774444447777"
"777777444477666666677777766774444447777"
"777777444477766666777777667744444447777"
"777777444447766666677776677744444447777"
"777777444444776666677766677444444447777"
"777777444444476666777666774444444444444"
"777777444444444777777777744444444444444"
"777777244444444477777744444444444444444"
"777777744444444444444444444444444444444"
"777777744444444444444444444444444444444"
"777777744444444444444444444444444444444"
"777777744444444444444444477244444444444"
"777777774444444444444444477444444444444"
"777777774444444444444444444444444777777"
"777777774444444444444444444444442777777"
"777777777444444444444444444444444444777"
"777777777444444444444444444444444444444"
"777777777744444444444444444444444444444"
"777777777774444444444444444444444444444"
"777777777777444444444444444444444444444"
"777777777777777777777777777777777777744"
"777777777777777777777777777777777777774"
"777777777777777777777777777777777777744"
"777777777777777777777777777777777744444"
"777777777777777777777777777777777444444"
"777777777777777777777777777777777744444"
"777777777777777777777777777777777744477"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777744777777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444444444444444444444444444444444"
"777777444444444444444444444444444444444"
"777777444444444444444444444444444444444"
"777777444444444444444444444444444444444"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777444477777777777777777777777777777"
"777777744777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777774444444444444444444"
"777777777777777777744444444444444444444"
"777777777777777777444444444444444444444"
"777777777777777774444444444444444444444"
"777777777777777774444777777744477777774"
"777777777777477774444777777744477777774"
"777777777774447774447777777744477777772"
"777777777744477774447777777744477777777"
"777777777444477774447777777744477777777"
"777777774444777774447777777744477777777"
"777777744442777774442777777744477777777"
"777777444447777774444777777744477777777"
"777777444477777774444477777744477777777"
"777777744477777777444444444444477777777"
"777777777777777777444444444444477777777"
"777777777777777777744444444444777777777"
"777777777777777777777744444447777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777724444444444444444444444444444444"
"777777444444444444444444444444444444444"
"777777444444444444444444444444444444444"
"777777444444444444444444444444444444444"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777444444444444444447"
"777777777777777777744444444444444444444"
"777777777777777777444444444444444444444"
"777777777777777777444444444444444444444"
"777777777777777774444477777744477777744"
"777777777777777774444777777744477777774"
"777777777774447774447777777744477777774"
"777777777744477774447777777744477777777"
"777777777444477774447777777744477777777"
"777777774444777774447777777744477777777"
"777777774444777774447777777744477777777"
"777777744447777774444777777744477777777"
"777777444447777774444477777744477777777"
"777777444477777774444444444444477777777"
"777777744777777777444444444444477777777"
"777777777777777777744444444444477777777"
"777777777777777777774444444444777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777666666666666666666666666666666"
"777777776666666666666666666666666666666"
"777777766666666666666666666666666666666"
"777777666666666666666666666666666666666"
"777777666667777776666777777777777777777"
"777777666677777776666777777777777777777"
"777777666677777776666777777777777777777"
"777777666677777776666777777777777777777"
"777777666677777776666777777777777777777"
"777777666677777776666777777777777777777"
"777777666677777776667777777777777777777"
"777777666677777777777777777777777777777"
"777777666677777777777777777777777777777"
"777777766777777777777777777777777777777"
"777777777777777777777777777776666666666"
"777777777777777777777777777766666666666"
"777777777777777776667777777666666666666"
"777777777777777776666777776666666666666"
"777777777777777776666777776666667777766"
"777777777777777776666777776666677777776"
"777777777777777776666777776666777777776"
"777777777777777776666777776666777777776"
"777777777777777776666777776666777777776"
"777777777777777776666777777666777777776"
"777777777777777776666777777666777777776"
"777777777777777776666777777766677777776"
"777777777777777776666677777766667777666"
"777777777777777776666666666666666666666"
"777777777777777777666666666666666666666"
"777777777777777777766666666666666666666"
"777777777777777777777666666666666666666"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777766666666666666666666666666666666"
"777777666666666666666666666666666666666"
"777777666666666666666666666666666666666"
"777777666666666666666666666666666666666"
"777777777777777777766667777777777777666"
"777777777777777777766777777777777777776"
"777777777777777777666777777777777777776"
"777777777777777776666777777777777777776"
"777777777777777776666777777777777777776"
"777777777777777776666777777777777777776"
"777777777777777776666777777777777777776"
"777777777777777776666777777777777777776"
"777777777777777776666677777777777777766"
"777777777777777776666666666666666666666"
"777777777777777777666666666666666666666"
"777777777777777777666666666666666666666"
"777777777777777777776666666666666666666"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777"
"777777777777777777777777777777777777777";
PROGMEM const char charSet2[]  = 
"666666666666666666666666666666666666666"
"666666000066666666666666666666666666666"
"666666000066666666666666666666666666666"
"666666000066666666666666666666666666666"
"666666000666666666666666666666666666666"
"666666000066666666666666666666666666666"
"666666000066666666666666666666666666666"
"666666000006666666666666666666666666666"
"666666000000666666666666666666666666666"
"666666000000060066666666666666666666666"
"666666000000000000666666666666666666666"
"666666600000000000066666666666666666666"
"666666600000000000006666666666666666666"
"666666600000000000000666666666666666666"
"666666600000000000000066666666666666666"
"666666600000000000066666666666666666666"
"660666000660000000066606666666666666666"
"600660606660000000066606666666666666666"
"000060666666000000066666666666666666666"
"000660666000000006666666662222666666666"
"006666046000000066666666222222266666222"
"006666000600000666666666222222222222222"
"660066606600066666666666222222222222266"
"600066666666066666666666622222222222266"
"600006666666666666666666622222222222666"
"600000000666666666666666666222222266666"
"000000000666666666666666666222222666666"
"000000006666666666666666666222226666666"
"000000066666666666666666666626666666666"
"000000066666666666666666666666666666666"
"000000666666666666666666666666666666666"
"600066666666666666666666666666666666666"
"606666666666666666666666666666666666666"
"666666666666666666664444666666666666666"
"666666666666666666444444466666666666666"
"666666666666666444444444466666666666666"
"666666666666644464444444466666666666666"
"666666666666444664444444466666666666666"
"666666666466444664444444446666666666666"
"666666644446444666444444444444446666666"
"666666444666444666444444444444444446666"
"666666446664444466444444444444444444666"
"666666444444444666444444444444444446666"
"666666444444446116644444444444444466666"
"666666664444446611116444444444466666666"
"666666661111111111111164444666666666666"
"666666611111111111111116446666666666666"
"666666611111116661161116666666666666666"
"666666611111111111111166666666666666666"
"666666611111111111116666666666666666666"
"666666111111111111116666666666666666666"
"666661111111111111111666666666666666666"
"666661511111111111111166666666666666666"
"666661111111111111111111666666666666666"
"666661111111111111111166666666666666666"
"666611111111111111111666666666666666666"
"666611111111111111111666666666666666666"
"666611111111111111111156666666666666666"
"666611111111111111111111666666666666666"
"666111111111111111111111666666666666666"
"666611111111111111111666666666666666666"
"666661111111111111111666666666666666666"
"666661111111111161116666666666665556666"
"666661111111111166666666666666655556666"
"666661111111111166666666666666655556666"
"666666111111111666666666666666555556666"
"666666111116116666666666666666665556666"
"666661111166666666666666666666655555666"
"666661111166666666666666666666665555666"
"666666111166666666666666666666666666666"
"666666111661666666666666666666666666666"
"666666111616666666666666666666666666666"
"666666111166666666666666666666666666666"
"666666111666666666666666666666666666666"
"666666111666666666666666666666666666666"
"666666116666666666666666666666666666666"
"666666616666666666666666666666666666666";
PROGMEM const char test[]  = "006666000600000666666666222222222222222"
"666111111111111111111111666666666666666";
// Pins
const int luminosityPin = A1;
//PROGMEM const char *string_table[] =
//{   
//"6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,6,6,6,6,;",
//"6,6,6,6,6,6,6,6,6,6,0,0,0,0,0,0,0,0,0,0,0,0,6,6,6,6,6,6,6,6,6,6,6,6,6,6,4,4,4,4,4,4,4,4,4,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,6,6,6,6,6,6,6,6,6,6,;",
//};
int nbrColonnes=76;


int leds [39]={A2,A3,A4,A5,A6,A7,A8,A9,A10,52,53,50,51,48,49,46,47,44,45,42,43,40,41,38,39,36,37,34,35,32,33,30,31,28,29,26,27,24,25};

int b = 23;

int r = 22;

int g = A0;



// the setup

void setup() {

  // initialize the digital pin as an output.

  Serial.begin(9600);
  


for (int i=0;i<39;i++) {pinMode( leds[i], OUTPUT );};

 pinMode(r, OUTPUT);

 pinMode(b, OUTPUT);

 pinMode(g, OUTPUT);
 
for (int i=0;i<39;i++) {digitalWrite( leds[i], LOW);};
digitalWrite( r, HIGH);
digitalWrite( g, HIGH);
digitalWrite( b, HIGH);

}








  
void allumerUneLed(int i,int j)
{  //initialisation
    char valeur = pgm_read_byte(&charSet2[j*39+i]);

    valeur=valeur-48;
    if (i==0) {digitalWrite( leds[38], LOW);}
   else {digitalWrite( leds[i-1], LOW);}
  
    //Allumage des leds concernees
     if (!(valeur==6)) {digitalWrite( leds[i], HIGH);}
 //initialisation des couleurs
digitalWrite( r, HIGH);
digitalWrite( g, HIGH);
digitalWrite( b, HIGH);
//Allumage des couleurs
 if (valeur==0) {digitalWrite( r, LOW);}
 else if (valeur==1) {digitalWrite( b, LOW);}
 else if (valeur==2) {digitalWrite( g, LOW);}
 else if (valeur==3) {digitalWrite( g, LOW);digitalWrite( b, LOW);}
 else if (valeur==4) {digitalWrite( g, LOW);digitalWrite( r, LOW);}
 else if (valeur==5) {digitalWrite( r, LOW);digitalWrite( b, LOW);}
 //else if (valeur==6) {digitalWrite( r, LOW);digitalWrite( b, LOW);digitalWrite( g, LOW)}
 else  {digitalWrite( r, LOW);}


}

void allumerColonne(int j)
{
  

for (int i=0;i<39;i++) {allumerUneLed(i,j);};
}



boolean testCapteur(int sensorValue,boolean b){

  if (sensorValue<600) {b=false;}
  else if (sensorValue>=600) {b= true;}
  return b;
}

// the loop routine runs over and over again forever:
void loop() {
  //choixLedAllumees ();
  while (true){
  boolean b=true;
  int j=0;  
    
    while (j<nbrColonnes){
       
        
//    int waitTime = map(sensorValue, 200, 800, 20, 1000);

//  Serial.print("\tDelai de clignotement (millisecondes) = ");
//  Serial.println(waitTime);
    int i=0; 

        while (i<1) //la valeur de i controle le temps d'allumage de chaque colonne
          { int sensorValue = analogRead(luminosityPin);
          //Serial.println(sensorValue);
            b=testCapteur(sensorValue,b);
            if (b==false) {break;}
            allumerColonne(j);
            i++;
          }
     if (b==false) {break;}
    j++;  
    }
  
  }

}
